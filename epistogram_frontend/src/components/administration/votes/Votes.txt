import React, {useEffect} from 'react';
import AdminDashboardHeader from "../universal/adminDashboardHeader/AdminDashboardHeader";
import {AdminDashboardSearch} from "../universal/searchBar/AdminDashboardSearch";
import instance from "../../../services/axiosInstance";
import {none, useState} from "@hookstate/core";
import {AdministrationListItem} from "../universal/adminDashboardSearchItem/AdministrationListItem";
import {Route, Switch} from "react-router-dom";
import {AdminDashboardWrapper} from "../universal/adminDashboardWrapper/AdminDashboardWrapper";
import {AdminDashboardList} from "../universal/adminDashboardList/AdminDashboardList";
import {AxiosResponse} from "axios";
import {UserStatistics} from "../users/userStatistics/UserStatistics";
import {AddVote} from "./votes_components/AddVote";
import {Add} from "@mui/icons-material";
import {Fab} from "@mui/material";
import { backendUrl } from '../../../Environemnt';

export const Votes: React.FunctionComponent = () => {
    const admin = useState(adminSideState)

    useEffect(() => {
        instance.get("/votes/getvotes").then((res: AxiosResponse<vote[]>) => {
            admin.votes.set(res.data)
        }).catch((e) => {
            return e
        })

        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [])

    const searchChangeHandler = (name: string, value: string) => {
        instance.get("/votes/getvotes").then((res: AxiosResponse<vote[]>) => {
            admin.votes.set(res.data)
        }).catch((e) => {
            return e
        })
    }
    return (
        <Switch>
            <Route exact path={'/admin/manage/votes'}>
                <AdminDashboardWrapper>
                    <AdminDashboardHeader titleText={""} />
                    <AdminDashboardSearch searchChangeHandler={searchChangeHandler} name={"searchData"} title={"Szavazások"}/>
                    <AdminDashboardList>
                        {admin.votes.get().map((vote, index) => {
                            return <AdministrationListItem title={vote.voteQuestion}
                                                           chips={[
                                                                 {label: (vote.voteFirstAnswerCount + vote.voteSecondAnswerCount).toString(), icon: "vote"},
                                                                 {label: `${vote.voteFirstAnswerCount} szavazat az első opcióra`, icon: ""},
                                                                 {label: `${vote.voteSecondAnswerCount} szavazat a második opcióra`, icon: ""}]}
                                                           key={vote._id}
                                                           searchItemButtons={[
                                                                 {
                                                                     selectedComponent: "editCourse",
                                                                     icon: "edit",
                                                                     onClick: () => {

                                                                     }
                                                                 }, {
                                                                     selectedComponent: "userStatistics",
                                                                     icon: "statistics",
                                                                     onClick: () => {

                                                                     }
                                                                 }, {
                                                                     icon: "delete",
                                                                     onClick: () => {
                                                                         instance.delete(`${backendUrl}articles/deletevote?voteId=${vote._id}`).then(() => {
                                                                             return admin.articles[index].set(none)
                                                                         }).catch(e => console.error(e.toString()))
                                                                     }
                                                                 },]
                                                             }/>})}

                    </AdminDashboardList>
                    <Fab color="primary"
                         aria-label="add"
                         style={{position: "absolute", bottom: 45, right: 45}}>
                        <Add />
                    </Fab>
                </AdminDashboardWrapper>
            </Route>
            <Route path={'/admin/add/vote'}>
                <AddVote />
            </Route>
        </Switch>

    );
};
