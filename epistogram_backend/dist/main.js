(()=>{"use strict";var e={4953:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getArticles=void 0;const r=o(6084),s=o(1637);t.getArticles=(e,t)=>{n(void 0,void 0,void 0,(function*(){const e=yield r.Connection.db.collection("articles").find({}).toArray();return s.responseReducer(200,e)})).then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch((e=>{t.status(400).send(e.errorText)}))}},674:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(4953);t.router.get("/getarticles",r.getArticles)},6426:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addToCourse=void 0;const r=o(6084),s=o(1637),a=o(7548),i=o(8417);t.addToCourse=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("courses").updateOne({_id:new a.ObjectID(e.params.courseId)},{$push:i.flattenObject(e.body)})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},5165:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createCourse=void 0;const r=o(6084),s=o(1637),a=o(3647);t.createCourse=(e,t,o)=>{let i;console.log(JSON.parse(JSON.stringify(e.body))),n(void 0,void 0,void 0,(function*(){return e.files&&(i=e.files.file),r.Connection.db.collection("courses").insertOne(e.body).then((e=>(a.createFile(i,"/var/lib/assets/epistogram@development/courses/",e.insertedId),s.responseReducer(200,"Adatok hozzáadva az adatbázishoz ")))).catch((e=>s.responseReducer(400,"Az adatok hozzáadása sikertelen"+e)))})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.responseText)}))}},4296:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCourse=void 0;const r=o(1637),s=o(6084),a=o(7548);t.deleteCourse=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield s.Connection.db.collection("courses").deleteOne({_id:new a.ObjectID(e.params.courseId)})}catch(e){throw new Error("A kurzus törlése sikertelen")}return r.responseReducer(200,"A kurzus sikeresen törölve")})).then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch(o)}},8477:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.editCourse=void 0;const r=o(6084),s=o(1637),a=o(7548),i=o(8417);t.editCourse=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("courses").updateOne({_id:new a.ObjectID(e.params.courseId)},{$set:i.flattenObject(e.body)})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},2649:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getAllCourses=void 0;const{responseReducer:r}=o(1637),{Connection:s}=o(6084),a=o(378);t.getAllCourses=(e,t,o)=>{a.checkRequest(e,t,o,["userId"]),function(){return n(this,void 0,void 0,(function*(){const t=yield s.db.collection("courses").aggregate([{$lookup:{from:"users",let:{userId:{$toObjectId:"6022c270f66f803c80243250"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$userId"]}}}],as:"user"}},{$unwind:{path:"$user",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"organizations",localField:"organizationId",foreignField:"_id",as:"org"}},{$unwind:{path:"$org",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"users",let:{teacherId:{$convert:{input:"$teacherId",to:7,onError:"",onNull:""}}},pipeline:[{$match:{$expr:{$eq:["$_id","$$teacherId"]}}}],as:"teacher"}},{$unwind:{path:"$teacher",preserveNullAndEmptyArrays:!0}},{$addFields:{courseTagsAsArrayOfObject:{$map:{input:"$tags",as:"line",in:{$mergeObjects:[{_id:"$$line"}]}}}}},{$addFields:{courseAndUserTags:{$filter:{input:"$user.userStatistics.tags",as:"line",cond:{$in:["$$line._id","$courseTagsAsArrayOfObject._id"]}}}}},{$lookup:{from:"tags",as:"doneTags",let:{courseAndUserTagsLocal:"$courseAndUserTags"},pipeline:[{$match:{$expr:{$in:["$_id","$$courseAndUserTagsLocal._id"]}}},{$project:{name:1,count:{$filter:{input:"$$courseAndUserTagsLocal",as:"tag",cond:{$eq:["$$tag._id","$_id"]}}}}},{$unwind:"$count"},{$project:{_id:1,count:"$count.count",name:1}}]}},{$addFields:{sumCount:{$sum:{$map:{input:"$doneTags",as:"line",in:"$$line.count"}}}}},{$match:{$expr:{$cond:[{$eq:[e.query.isRecommended,"true"]},{$ne:["$doneTags",[]]},{a:"a"}]}}},{$match:{$expr:{$cond:[{$eq:[e.query.featured,"true"]},{$eq:["$featured",!0]},{a:"a"}]}}},{$addFields:{filteredGroups:{$filter:{input:"$user.userData.groups",as:"userGroup",cond:{$in:["$$userGroup.groupId",{$ifNull:["$groups",[]]}]}}}}},{$match:{$and:[{$or:[{name:new RegExp(e.query.searchData,"i")},{category:new RegExp(e.query.searchData,"i")}]},{category:new RegExp(e.query.category,"i")},{$expr:{$cond:{if:{$ne:[e.query.organizationId,null]},then:{$eq:[e.query.organizationId,"$organizationId"]},else:{}}}},{$expr:{$cond:{if:{$ne:["$user.userData.role","admin"]},then:{$eq:["$user.userData.organizationId","$organizationId"]},else:{}}}}]}},{$addFields:{videos:{$filter:{input:"$items",cond:{$eq:["$$this.type","video"]}}}}},{$addFields:{exams:{$filter:{input:"$items",cond:{$eq:["$$this.type","exam"]}}}}},{$lookup:{from:"videos",let:{localVideos:"$videos"},pipeline:[{$match:{$expr:{$filter:{input:"$$localVideos",as:"video",cond:{$eq:["$_id",{$toObjectId:"$$video.itemId"}]}}}}}],as:"videosWithData"}},{$lookup:{from:"exams",let:{localExams:"$exams"},pipeline:[{$match:{$expr:{$filter:{input:"$$localExams",as:"exam",cond:{$eq:["$_id",{$toObjectId:"$$exam.itemId"}]}}}}}],as:"examsWithData"}},{$addFields:{videosWithAllData:{$map:{input:"$videos",as:"video",in:{$mergeObjects:["$$video",{$arrayElemAt:[{$filter:{input:"$videosWithData",as:"extVideo",cond:{$eq:[{$toObjectId:"$$video.itemId"},"$$extVideo._id"]}}},0]}]}}}}},{$addFields:{examsWithAllData:{$map:{input:"$exams",as:"exam",in:{$mergeObjects:["$$exam",{$arrayElemAt:[{$filter:{input:"$examsWithData",as:"extExam",cond:{$eq:[{$toObjectId:"$$exam.itemId"},"$$extExam._id"]}}},0]}]}}}}},{$addFields:{allItems:{$concatArrays:["$videosWithAllData","$examsWithAllData"]}}},{$project:{name:1,category:1,teacherName:"$teacher.name",colorOne:1,colorTwo:1,thumbnailUrl:1,items:"$allItems",groups:"$groups",filteredGroups:"$filteredGroups"}}]).toArray();return r(200,t)}))}().then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch(o)}},6064:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getCourse=void 0;const r=o(6084),s=o(1637),a=o(7548);t.getCourse=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const t=yield r.Connection.db.collection("courses").aggregate([{$match:{_id:new a.ObjectID(e.params.courseId+"")}},{$addFields:{videos:{$filter:{input:"$items",cond:{$eq:["$$this.type","video"]}}}}},{$addFields:{exams:{$filter:{input:"$items",cond:{$eq:["$$this.type","exam"]}}}}},{$lookup:{from:"videos",let:{localVideos:"$videos"},pipeline:[{$match:{$expr:{$filter:{input:"$$localVideos",as:"localVideo",cond:{$eq:["$_id","$$localVideo._id"]}}}}},{$addFields:{overlaysCount:{$cond:{if:{$isArray:"$overlays"},then:{$size:"$overlays"},else:1}}}}],as:"videosWithData"}},{$lookup:{from:"exams",localField:"exams.itemId",foreignField:"_id",as:"examsWithData"}},{$addFields:{videosWithAllData:{$map:{input:"$videos",as:"video",in:{$mergeObjects:["$$video",{$arrayElemAt:[{$filter:{input:"$videosWithData",as:"extVideo",cond:{$eq:["$$video.itemId","$$extVideo._id"]}}},0]}]}}}}},{$addFields:{examsWithAllData:{$map:{input:"$exams",as:"exam",in:{$mergeObjects:["$$exam",{$arrayElemAt:[{$filter:{input:"$examsWithData",as:"extExam",cond:{$eq:["$$exam.itemId","$$extExam._id"]}}},0]}]}}}}},{$addFields:{allItems:{$concatArrays:["$videosWithAllData","$examsWithAllData"]}}},{$addFields:{courseTagsAsArrayOfObject:{$map:{input:"$tags",as:"line",in:{$mergeObjects:[{_id:"$$line"}]}}}}},{$lookup:{from:"tags",pipeline:[],as:"tagsFromCollection"}},{$addFields:{doneTags:{$map:{input:"$courseTagsAsArrayOfObject",as:"line",in:{$filter:{input:"$tagsFromCollection",as:"linee",cond:{$eq:["$$linee._id",{$toObjectId:"$$line._id"}]}}}}}}},{$addFields:{doneTagsAsObjects:{$map:{input:"$doneTags",as:"line",in:{$mergeObjects:"$$line"}}}}},{$addFields:{groupsAsArrayOfObject:{$map:{input:"$groups",as:"line",in:{$mergeObjects:[{_id:"$$line"}]}}}}},{$lookup:{from:"groups",pipeline:[],as:"groupsFromCollection"}},{$addFields:{doneGroups:{$map:{input:"$groupsAsArrayOfObject",as:"line",in:{$filter:{input:"$groupsFromCollection",as:"linee",cond:{$eq:["$$linee._id",{$toObjectId:"$$line._id"}]}}}}}}},{$addFields:{doneGroupsAsObjects:{$map:{input:"$doneGroups",as:"line",in:{$mergeObjects:"$$line"}}}}},{$project:{_id:1,name:1,category:1,courseGroup:1,teacherId:1,organizationId:1,permissionLevel:1,featured:1,tags:"$doneTagsAsObjects",items:"$allItems",groups:"$doneGroupsAsObjects",colorOne:1,colorTwo:1}}]).toArray();return s.responseReducer(200,t[0])})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},9598:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeFromCourse=void 0;const r=o(6084),s=o(1637),a=o(7548),i=o(8417);t.removeFromCourse=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("courses").updateOne({_id:new a.ObjectID(e.params.courseId)},{$pull:i.flattenObject(e.body)})}catch(t){throw new Error("Shit heppönsz"+JSON.stringify(e.body))}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},1863:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadCourseImage=void 0;const r=o(3647),s=o(1637);t.uploadCourseImage=(e,t,o)=>{let a;n(void 0,void 0,void 0,(function*(){return e.files&&(a=e.files.file),r.createFile(a,"/var/lib/assets/epistogram@development/courses/",e.params.courseId),s.responseReducer(201,"Adatok hozzáadva az adatbázishoz ")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.responseText)}))}},5733:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(2649),s=o(6064),a=o(5165),i=o(4296),d=o(6426),c=o(9598),u=o(8477),l=o(1863);t.router.get("/",r.getAllCourses),t.router.get("/course/:courseId",s.getCourse),t.router.put("/course/:courseId",d.addToCourse),t.router.patch("/course/:courseId",u.editCourse),t.router.patch("/course/:courseId/remove",c.removeFromCourse),t.router.put("/course/:courseId/image",l.uploadCourseImage),t.router.delete("/course/:courseId",i.deleteCourse),t.router.post("/createCourse",a.createCourse)},9253:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uploadAvatarImage=void 0,t.uploadAvatarImage=(e,t,o)=>{}},392:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uploadThumbnailImage=void 0,t.uploadThumbnailImage=(e,t,o)=>{}},850:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uploadVoteImages=void 0,t.uploadVoteImages=(e,t,o)=>{}},1284:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(9253),s=o(392),a=o(850);t.router.post("/uploadavatar",r.uploadAvatarImage),t.router.post("/uploadthumbnail",s.uploadThumbnailImage),t.router.post("/uploadvotes",a.uploadVoteImages)},5506:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getGroups=void 0;const{responseReducer:r}=o(1637),{Connection:s}=o(6084);t.getGroups=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const e=yield s.db.collection("groups").aggregate([]).toArray();return r(200,e)})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},5123:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(5506);t.router.get("/",r.getGroups)},6176:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getOrganizations=void 0;const r=o(1637),s=o(6084);t.getOrganizations=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const e=yield s.Connection.db.collection("organizations").aggregate([]).toArray();return r.responseReducer(200,e)})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},3913:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(6176);t.router.get("/getorganizations",r.getOrganizations)},6922:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadOverlay=void 0;const r=o(6084),s=o(1637);t.uploadOverlay=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){return r.Connection.db.collection("videos").insertOne(e.body).then((e=>s.responseReducer(200,"Adatok hozzáadva az adatbázishoz "+e))).catch((e=>s.responseReducer(400,"Az adatok hozzáadása sikertelen"+e)))})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},3268:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127),r=o(6922);t.router=n.Router(),t.router.post("/",r.uploadOverlay)},6402:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteTag=void 0;const r=o(7548),s=o(6084),a=o(1637);t.deleteTag=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield s.Connection.db.collection("tags").deleteOne({_id:new r.ObjectID(e.params.tagId)})}catch(e){throw new Error("A tag törlése sikertelen")}return a.responseReducer(200,"Tag sikeresen törölve")})).then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch(o)}},7291:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getTags=void 0;const r=o(1637),s=o(6084);t.getTags=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const t=yield s.Connection.db.collection("tags").aggregate([{$match:{name:new RegExp(e.query.searchData,"i")}}]).toArray();return r.responseReducer(200,t)})).then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch(o)}},9763:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateTag=void 0;const r=o(6084),s=o(1637),a=o(7548);t.updateTag=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){if(e.body.name&&""!=e.body.name&&e.body._id&&""!=e.body._id){console.log("VanNameVanId");const t=yield r.Connection.db.collection("tags").findOne({name:e.body.name}).catch((e=>{throw new Error("TagByName nem sikerült")})),o=yield r.Connection.db.collection("tags").findOne({_id:new a.ObjectID(e.body._id)}).catch((e=>{throw new Error("Tag nem található")}));if(console.log("VanNameVanId2"+o+JSON.stringify(t)),o&&t)throw console.log("Jó_idJótagName"),new Error("A tag már létezik");if(o&&!t)return console.log("Jó_idNincsTagNameAzAdatbazisban"),yield r.Connection.db.collection("tags").findOneAndUpdate({_id:new a.ObjectID(e.body._id)},{$set:{name:e.body.name}}),s.responseReducer(200,"Tag frissítve");if(o||t)throw console.log("Van ilyen tag"),new Error("Már van ilyen tag");return console.log("RosszIdNincsTagNameAzAdatbazisban"),r.Connection.db.collection("tags").insertOne({name:e.body.name}).then((t=>(e.body.courseId&&""!=e.body.courseId&&r.Connection.db.collection("courses").findOneAndUpdate({_id:new a.ObjectID(e.body.courseId)},{$push:{tags:e.body._id||t.insertedId.toString()}}),s.responseReducer(201,{_id:t.insertedId.toString()})))).catch((e=>{throw new Error("A tag hozzáadása az adatbázishoz sikertelen")}))}if(e.body.name&&""!=e.body.name){if(console.log("NincsIdNincsTagNameAzAdatbazisban"),yield r.Connection.db.collection("tags").findOne({name:new RegExp(e.body.name,"i")}).catch((e=>{throw new Error("TagByName nem sikerült")})))throw new Error("Már van ilyen tag");return r.Connection.db.collection("tags").insertOne({name:e.body.name}).then((t=>(e.body.courseId&&""!=e.body.courseId&&r.Connection.db.collection("courses").findOneAndUpdate({_id:new a.ObjectID(e.body.courseId)},{$push:{tags:e.body._id||t.insertedId.toString()}}),s.responseReducer(201,{_id:t.insertedId.toString()})))).catch((e=>{throw new Error("A tag hozzáadása az adatbázishoz sikertelen")}))}throw console.log("NincsIdNincsTagName"),new Error("Hibás kérés")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(JSON.stringify(e))}))}},5218:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127),r=o(7291),s=o(9763),a=o(6402);t.router=n.Router(),t.router.get("/",r.getTags),t.router.patch("/",s.updateTag),t.router.delete("/:tagId",a.deleteTag)},8695:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setTask=void 0;const r=o(1637),s=o(378),a=o(6084),i=o(7548);t.setTask=(e,t,o)=>{s.checkRequest(e,t,o,["userId","taskToUserId","taskName","dueDate","state"]),n(void 0,void 0,void 0,(function*(){return yield a.Connection.db.collection("users").updateOne({_id:new i.ObjectID(e.body.taskToUserId)},{$push:{"userData.tasks":{addedDate:Date.now(),name:e.body.taskName,from:new i.ObjectID(e.body.userId),due:Date.parse(e.body.dueDate),state:e.body.state}}}),r.responseReducer(200,"")})).then((e=>t.status(e.responseStatus).send(e.responseText)))}},880:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127),r=o(8695);t.router=n.Router(),t.router.put("/settask",r.setTask)},3166:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteUser=void 0;const r=o(1637),s=o(6084),a=o(7548);t.deleteUser=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield s.Connection.db.collection("users").deleteOne({_id:new a.ObjectID(e.params.userId)})}catch(e){throw new Error("A felhasználó törlése sikertelen")}return r.responseReducer(200,"Felhasználó sikeresen törölve")})).then((e=>{t.status(e.responseStatus).json(e.responseText)})).catch(o)}},4294:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getUsers=void 0;const r=o(1637),s=o(6084),a=o(378),i=o(7548);t.getUsers=(e,t,o)=>{a.checkRequest(e,t,o,["userId","organizationId"]),n(void 0,void 0,void 0,(function*(){switch((yield s.Connection.db.collection("users").findOne({_id:new i.ObjectID(e.query.userId)})).userData.role){case"admin":const t=yield s.Connection.db.collection("users").aggregate([{$lookup:{from:"organizations",let:{organizationId:{$toObjectId:"$userData.organizationId"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$organizationId"]}}}],as:"orgs"}},{$unwind:{path:"$orgs",preserveNullAndEmptyArrays:!0}},{$project:{_id:1,active:"$userData.active",email:"$userData.email",firstName:"$userData.firstName",lastName:"$userData.lastName",phoneNumber:"$userData.phoneNumber",role:"$userData.role",innerRole:"$userData.innerRole",organizationName:"$orgs.organizationName",name:{$concat:["$userData.lastName"," ","$userData.firstName"]},tasks:"$userData.tasks"}},{$match:{name:new RegExp(e.query.searchData,"i")}}]).toArray();return r.responseReducer(200,t);case"owner":const o=yield s.Connection.db.collection("users").aggregate([{$lookup:{from:"organizations",let:{organizationId:{$toObjectId:"$userData.organizationId"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$organizationId"]}}}],as:"orgs"}},{$unwind:{path:"$orgs",preserveNullAndEmptyArrays:!1}},{$project:{_id:1,active:"$userData.active",email:"$userData.email",firstName:"$userData.firstName",lastName:"$userData.lastName",phoneNumber:"$userData.phoneNumber",role:"$userData.role",innerRole:"$userData.innerRole",organizationName:"$orgs.organizationName",name:{$concat:["$userData.lastName"," ","$userData.firstName"]},groups:"$filteredGroups.groupName"}}]).toArray();return r.responseReducer(200,o);case"supervisor":const n=yield s.Connection.db.collection("users").aggregate([{$lookup:{from:"organizations",let:{organizationId:{$toObjectId:"$userData.organizationId"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$organizationId"]}}}],as:"orgs"}},{$unwind:{path:"$orgs",preserveNullAndEmptyArrays:!1}},{$lookup:{from:"groups",let:{groups:{$ifNull:["$userData.groups",[]]},userId:{$toObjectId:"6022c270f66f803c80243250"}},pipeline:[{$match:{$expr:{$eq:["$$userId","$groupSupervisorId"]}}}],as:"searchableGroups"}},{$lookup:{from:"groups",localField:"userData.groups.groupId",foreignField:"_id",as:"filteredGroups"}},{$match:{"filteredGroups.0":{$exists:!0}}},{$project:{_id:1,active:"$userData.active",email:"$userData.email",firstName:"$userData.firstName",lastName:"$userData.lastName",phoneNumber:"$userData.phoneNumber",role:"$userData.role",innerRole:"$userData.innerRole",organizationName:"$orgs.organizationName",name:{$concat:["$userData.lastName"," ","$userData.firstName"]},groups:"$filteredGroups.groupName"}}]).toArray();return r.responseReducer(200,n);default:throw new Error("A felhasználó egyik rolenak sem felel meg")}})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.toString())}))}},6902:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.login=void 0;const s=r(o(2773)),a=r(o(9722)),i=o(1637),d=o(6084);t.login=(e,t)=>{const o=e.query.email,r=e.query.password;n(void 0,void 0,void 0,(function*(){let t;try{t=yield d.Connection.db.collection("users").findOne({"userData.email":o})}catch(e){return i.responseReducer(401,"Invalid credentials, could not log you in. "+e)}if(!t)return i.responseReducer(401,"Invalid credentials, could not log you in.");let n,c=!1;try{c=yield s.default.compare(r,t.userData.password)}catch(e){return i.responseReducer(400,"No credentials, could not log you inc. "+e)}if(!c)return i.responseReducer(401,"No credentials, could not log you ind. "+e.query.password+" asd"+c);try{n=a.default.sign({userId:t._id,email:t.userData.email},"AROWILLSAVETHECODE",{expiresIn:"24h"})}catch(e){return i.responseReducer(500,"Logging in failed, please try again later."+e)}return i.responseReducer(200,{userId:t._id,supervisorId:t.userData.supervisorId,email:t.userData.email,role:t.userData.role,token:n,organizationId:t.userData.organizationId})})).then((e=>t.status(e.responseStatus).end(JSON.stringify(e.responseText)))).catch((e=>t.status(e.errorCode).end(e.errorText)))}},8575:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.newGetUser=void 0;const r=o(1637),s=o(6084),a=o(7548);t.newGetUser=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const t=yield s.Connection.db.collection("users").aggregate([{$match:{_id:new a.ObjectID(e.params.userId)}},{$set:{"userData.currentItemId":{$toObjectId:"$userData.currentItemId"}}},{$lookup:{from:"courses",let:{currentCourseId:{$toObjectId:"$userData.currentCourseId"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$currentCourseId"]}}}],as:"currentCourse"}},{$unwind:{path:"$currentCourse",preserveNullAndEmptyArrays:!0}},{$addFields:{items:"$currentCourse.items"}},{$addFields:{videos:{$filter:{input:"$items",cond:{$eq:["$$this.type","video"]}}}}},{$addFields:{exams:{$filter:{input:"$items",cond:{$eq:["$$this.type","exam"]}}}}},{$lookup:{from:"videos",let:{localVideos:"$videos"},pipeline:[{$match:{$expr:{$filter:{input:"$$localVideos",as:"video",cond:{$eq:["$_id",{$toObjectId:"$$video.itemId"}]}}}}}],as:"videosWithData"}},{$lookup:{from:"exams",let:{localExams:"$exams"},pipeline:[{$match:{$expr:{$filter:{input:"$$localExams",as:"exam",cond:{$eq:["$_id",{$toObjectId:"$$exam.itemId"}]}}}}}],as:"examsWithData"}},{$addFields:{videosWithAllData:{$map:{input:"$videos",as:"video",in:{$mergeObjects:["$$video",{$arrayElemAt:[{$filter:{input:"$videosWithData",as:"extVideo",cond:{$eq:[{$toObjectId:"$$video.itemId"},"$$extVideo._id"]}}},0]}]}}}}},{$addFields:{examsWithAllData:{$map:{input:"$exams",as:"exam",in:{$mergeObjects:["$$exam",{$arrayElemAt:[{$filter:{input:"$examsWithData",as:"extExam",cond:{$eq:[{$toObjectId:"$$exam.itemId"},"$$extExam._id"]}}},0]}]}}}}},{$addFields:{allItems:{$concatArrays:["$videosWithAllData","$examsWithAllData"]}}},{$lookup:{from:"videos",localField:"userData.currentItemId",foreignField:"_id",as:"currentItemVideoNeo"}},{$unwind:{path:"$currentItemVideoNeo",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"overlays",let:{inOverlays:"$currentItemVideoNeo.overlays"},pipeline:[{$match:{$expr:{$filter:{input:"$$inOverlays",as:"overlay",cond:{$eq:["$_id","$$overlay._id"]}}}}}],as:"allOverlays"}},{$lookup:{from:"videos",let:{videoId:"$userData.currentItemId",asd:"$allOverlays"},pipeline:[{$match:{$expr:{$eq:["$_id",{$toObjectId:"$$videoId"}]}}},{$addFields:{overlays:"$$asd"}}],as:"currentItemVideo"}},{$unwind:{path:"$currentItemVideo"}},{$lookup:{from:"exams",localField:"userData.currentItemId",foreignField:"_id",as:"currentItemExam"}},{$unwind:{path:"$currentItemExam",preserveNullAndEmptyArrays:!0}},{$addFields:{currentItem:{$mergeObjects:["$currentItemVideo","$currentItemExam"]}}},{$lookup:{from:"courses",localField:"userStatistics.courses._id",foreignField:"_id",as:"doneCourses"}},{$lookup:{from:"exams",localField:"userStatistics.exams._id",foreignField:"_id",as:"doneExams"}},{$lookup:{from:"votes",pipeline:[{$match:{$expr:{$eq:["$active",!0]}}}],as:"vote"}},{$unwind:{path:"$vote",preserveNullAndEmptyArrays:!0}},{$lookup:{from:"courses",localField:"userStatistics.tags._id",foreignField:"tags",as:"recommendedCourses"}},{$project:{asd:"$allOverlays",userData:{allowedMachinesAtHome:"$userData.security.allowedMachines",avatarUrl:"$userData.avatarUrl",badges:"$userData.badges",currentCourse:{$mergeObjects:["$currentCourse",{items:"$allItems"}]},currentSeeSomethingNew:"{}",currentItem:"$currentItem",doneCourses:"$doneCourses",doneExams:"$doneExams",email:1,epistoCoins:1,firstName:1,favoriteCourses:[],innerRole:1,lastName:1,linkedInUrl:1,notes:1,phoneNumber:1,recommendedCourses:"$recommendedCourses",role:1,tasks:1,username:1,userDescription:1,watchedVideosCount:"0"},userStatistics:1,vote:"$vote"}}]).toArray();return r.responseReducer(200,t[0])})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.toString())}))}},1711:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.resetUser=void 0;const s=o(1637),a=o(6084),i=o(7548),d=r(o(6926)),c=o(9849),u=o(8038),l=o(8768);t.resetUser=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const n=yield a.Connection.db.collection("users").findOne({_id:new i.ObjectID(e.params.userId)}),r=yield l.generateToken(e,t,o,n._id,n.userData.email);return yield new d.default(c.emailConfig).send(c.emailContent(n.userData.email,`${n.userData.lastName} ${n.userData.firstName}`,`${u.config.frontendUrl}/regisztracio`,r)).catch((e=>{throw new Error("Jelszó visszaállító e-mail kiküldése sikertelen"+e)})),s.responseReducer(200,"Jelszó visszaállító e-mail kiküldve")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},423:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateActivity=void 0;const s=o(6084),a=o(1637),i=o(7548),d=o(378),c=r(o(9722)),u=o(8038);t.updateActivity=(e,t,o)=>{d.checkRequest(e,t,o,["actionType","actionTriggererURL","actionTriggererItemName","actionTriggererItemLabel","activityType","description"]);const r=e.headers.authorization;let l;if(r){const e=r.split(" ")[1];c.default.verify(e,u.config.tokenMailSecret,((e,t)=>{if(e)throw new Error("A token ellenőrzése sikertelen");l=t}))}n(void 0,void 0,void 0,(function*(){console.log(e.body);try{yield s.Connection.db.collection("users").updateOne({_id:new i.ObjectID(null!=l?l.userId:"")},{$push:{activities:Object.assign({createdAt:Date.now()},e.body)}})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return a.responseReducer(200,"Adatfrissítés sikeres")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.toString())}))}},1023:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateCurrentCourse=void 0;const r=o(7548),s=o(8417),a=o(6084),i=o(1637);t.updateCurrentCourse=(e,t,o)=>{s.flattenObject(e.body),n(void 0,void 0,void 0,(function*(){let t;if(!e.params.courseId)throw new Error("Hibás kérés");if(t=yield a.Connection.db.collection("courses").aggregate([{$match:{_id:new r.ObjectID(e.params.courseId)}},{$addFields:{videos:{$filter:{input:"$items",cond:{$eq:["$$this.type","video"]}}}}},{$addFields:{exams:{$filter:{input:"$items",cond:{$eq:["$$this.type","exam"]}}}}},{$lookup:{from:"videos",let:{localVideos:"$videos"},pipeline:[{$match:{$expr:{$filter:{input:"$$localVideos",as:"video",cond:{$eq:["$_id",{$toObjectId:"$$video.itemId"}]}}}}}],as:"videosWithData"}},{$lookup:{from:"exams",let:{localExams:"$exams"},pipeline:[{$match:{$expr:{$filter:{input:"$$localExams",as:"exam",cond:{$eq:["$_id",{$toObjectId:"$$exam.itemId"}]}}}}}],as:"examsWithData"}},{$addFields:{videosWithAllData:{$map:{input:"$videos",as:"video",in:{$mergeObjects:["$$video",{$arrayElemAt:[{$filter:{input:"$videosWithData",as:"extVideo",cond:{$eq:[{$toObjectId:"$$video.itemId"},"$$extVideo._id"]}}},0]}]}}}}},{$addFields:{examsWithAllData:{$map:{input:"$exams",as:"exam",in:{$mergeObjects:["$$exam",{$arrayElemAt:[{$filter:{input:"$examsWithData",as:"extExam",cond:{$eq:[{$toObjectId:"$$exam.itemId"},"$$extExam._id"]}}},0]}]}}}}},{$addFields:{allItems:{$concatArrays:["$videosWithAllData","$examsWithAllData"]}}},{$project:{_id:1,name:1,thumbnailUrl:1,tags:1,category:1,courseGroup:1,permissionLevel:1,organizationId:1,creatorId:1,teacherId:1,teacherName:1,items:"$allItems"}}]).toArray(),t)return yield a.Connection.db.collection("users").findOneAndUpdate({_id:new r.ObjectID(e.params.userId)},{$set:s.flattenObject({userData:{currentCourseId:e.params.courseId,currentItemId:t[0].items[0]._id+""}})},{upsert:!1,new:!0},(e=>{if(e)throw new Error("Az adatok frissítése sikertelen!"+e)})),i.responseReducer(201,t[0]);throw new Error("Nincs ilyen kurzus")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},6457:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateCurrentItem=void 0;const r=o(6084),s=o(7548),a=o(8417),i=o(1637);t.updateCurrentItem=(e,t,o)=>{a.flattenObject(e.body),n(void 0,void 0,void 0,(function*(){const t=yield r.Connection.db.collection("courses").aggregate([{$addFields:{videos:{$filter:{input:"$items",cond:{$eq:["$$this.type","video"]}}}}},{$addFields:{exams:{$filter:{input:"$items",cond:{$eq:["$$this.type","exam"]}}}}},{$lookup:{from:"videos",let:{localVideos:"$videos"},pipeline:[{$match:{$expr:{$filter:{input:"$$localVideos",as:"video",cond:{$eq:["$_id",{$toObjectId:"$$video.itemId"}]}}}}}],as:"videosWithData"}},{$lookup:{from:"exams",let:{localExams:"$exams"},pipeline:[{$match:{$expr:{$filter:{input:"$$localExams",as:"exam",cond:{$eq:["$_id",{$toObjectId:"$$exam.itemId"}]}}}}}],as:"examsWithData"}},{$addFields:{videosWithAllData:{$map:{input:"$videos",as:"video",in:{$mergeObjects:["$$video",{$arrayElemAt:[{$filter:{input:"$videosWithData",as:"extVideo",cond:{$eq:[{$toObjectId:"$$video.itemId"},"$$extVideo._id"]}}},0]}]}}}}},{$addFields:{examsWithAllData:{$map:{input:"$exams",as:"exam",in:{$mergeObjects:["$$exam",{$arrayElemAt:[{$filter:{input:"$examsWithData",as:"extExam",cond:{$eq:[{$toObjectId:"$$exam.itemId"},"$$extExam._id"]}}},0]}]}}}}},{$addFields:{allItems:{$concatArrays:["$videosWithAllData","$examsWithAllData"]}}},{$match:{$expr:{$and:[{$eq:["$_id",{$toObjectId:e.params.courseId}]},{$filter:{input:"$allItems",as:"allItem",cond:{$eq:[{$toObjectId:"$$allItem._id"},{$toObjectId:e.params.itemId}]}}}]}}},{$addFields:{currentItem:{$filter:{input:"$allItems",as:"allItem",cond:{$eq:[{$toObjectId:"$$allItem._id"},{$toObjectId:e.params.itemId}]}}}}},{$unwind:"$currentItem"},{$project:{currentItem:1,currentCourse:{_id:"$_id",name:"$name",thumbnailUrl:"$thumbnailUrl",tags:"$tags",category:"$category",courseGroup:"$courseGroup",permissionLevel:"$permissionLevel",items:"$allItems"}}}]).toArray();if(!(e.params.itemId&&e.params.courseId&&e.params.userId&&t[0].currentItem._id==e.params.itemId))throw new Error("Hibás kérés");var o,n;return o=e.params.userId,n={"userData.currentCourseId":e.params.courseId,"userData.currentItemId":e.params.itemId},r.Connection.db.collection("users").findOneAndUpdate({_id:new s.ObjectID(o)},{$set:n},{upsert:!1,new:!0},(e=>{if(e)throw new Error("Az adatok frissítése sikertelen!"+e)})),i.responseReducer(201,t[0])})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},7543:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.updateUser=void 0;const s=o(7548),a=o(8417),i=r(o(2773)),d=o(3647),c=r(o(9722)),u=o(8038),{responseReducer:l}=o(1637),{Connection:p}=o(6084);t.updateUser=(e,t,o)=>{a.flattenObject(e.body),n(void 0,void 0,void 0,(function*(){if(!e.body.currentPassword&&e.body.newPassword){let o;const r=e.headers.authorization;let a,l;if(r){const e=r.split(" ")[1];c.default.verify(e,u.config.tokenMailSecret,((e,t)=>{if(e)throw new Error("A token ellenőrzése sikertelen");a=t}))}e.files&&(o=e.files.file,d.createFile(o,`/var/lib/assets/epistogram@development/users/${e.params.userId}/`,"avatar")),l=yield i.default.hash(e.body.newPassword,12),yield(t=null!=a?a.userId:"",n={"userData.phoneNumber":e.body.phoneNumber,"userData.password":l},void p.db.collection("users").findOneAndUpdate({_id:new s.ObjectID(t)},{$set:n},{upsert:!1,new:!0},(e=>{if(e)throw new Error("Az adatok frissítése sikertelen!"+e)})))}else if(e.body.currentPassword&&e.body.newPassword){let t,n;try{t=yield p.db.collection("users").findOne({_id:new s.ObjectID(e.params.userId)})}catch(e){throw new Error("A jelszó beállítása sikertelen: DB")}try{if(!(yield i.default.compare(e.body.currentPassword,t.userData.password))){const e=new Error("A jelszó beállítása sikertelen: Bcrypt");return o(e)}}catch(e){return o(e)}n=yield i.default.hash(e.body.newPassword,12)}var t,n;return l(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},2762:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.signup=void 0;const s=r(o(6926)),a=o(378),i=o(737),d=o(8038),c=o(6084),u=o(1637),l=o(9849),p=o(8768),$=r(o(2773));t.signup=(e,t,o)=>{a.checkRequest(e,t,o,["email","role","username","firstName","lastName","organizationId","innerRole"]),n(void 0,void 0,void 0,(function*(){yield i.checkUser(e,t,o);let n,r={userData:{active:!0,email:e.body.email,role:e.body.role,username:e.body.username,firstName:e.body.firstName,lastName:e.body.lastName,organizationId:e.body.organizationId,password:yield $.default.hash("abcd",12),innerRole:e.body.innerRole}};try{n=yield c.Connection.db.collection("users").insertOne(r)}catch(e){throw new Error("Shit heppönsz"+e.toString())}const a=yield p.generateToken(e,t,o,n.insertedId,r.userData.email);return yield new s.default(l.emailConfig).send(l.emailContent(e.body.email,`${e.body.lastName} ${e.body.firstName}`,`${d.config.frontendUrl}/signup`,a)).catch((e=>{throw new Error("Signing up failed, please try again later."+e)})),u.responseReducer(201,"Sikeres regisztráció")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.toString())}))}},6825:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(4294),s=o(6902),a=o(2762),i=o(3166),d=o(7543),c=o(1711),u=o(8575),l=o(6457),p=o(1023),$=o(423);t.router.get("/login",s.login),t.router.get("/",r.getUsers),t.router.post("/",a.signup),t.router.patch("/",d.updateUser),t.router.patch("/activity",$.updateActivity),t.router.get("/:userId",u.newGetUser),t.router.patch("/:userId",d.updateUser),t.router.delete("/:userId",i.deleteUser),t.router.patch("/:userId/course/:courseId",p.updateCurrentCourse),t.router.patch("/:userId/course/:courseId/item/:itemId",l.updateCurrentItem),t.router.get("/:userId/reset",c.resetUser)},3236:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getVideo=void 0;const r=o(7548),{responseReducer:s}=o(1637),{Connection:a}=o(6084);t.getVideo=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const t=yield a.db.collection("videos").aggregate([{$lookup:{from:"courses",let:{courseId:{$toObjectId:"$courseId"}},pipeline:[{$match:{$expr:{$eq:["$_id","$$courseId"]}}}],as:"courses"}},{$unwind:{path:"$courses",preserveNullAndEmptyArrays:!0}},{$match:{_id:new r.ObjectID(e.params.videoId+"")}},{$addFields:{courseTagsAsArrayOfObject:{$map:{input:"$tags",as:"line",in:{$mergeObjects:[{_id:"$$line"}]}}}}},{$lookup:{from:"tags",pipeline:[],as:"tagsFromCollection"}},{$addFields:{doneTags:{$map:{input:"$courseTagsAsArrayOfObject",as:"line",in:{$filter:{input:"$tagsFromCollection",as:"linee",cond:{$eq:["$$linee._id",{$toObjectId:"$$line._id"}]}}}}}}},{$addFields:{doneTagsAsObjects:{$map:{input:"$doneTags",as:"line",in:{$mergeObjects:"$$line"}}}}},{$lookup:{from:"overlays",let:{inOverlays:"$overlays"},pipeline:[{$match:{$expr:{$map:{input:"$$inOverlays",as:"overlay",in:{$eq:["$_id","$$overlay._id"]}}}}}],as:"allOverlays"}},{$project:{_id:1,thumbnailUrl:1,title:1,subTitle:1,length:1,watchCount:"0",description:1,url:1,overlays:"$allOverlays",tags:"$doneTagsAsObjects",showAutomaticOverlay:1,courseName:"$courses.name"}}]).toArray();return s(200,t[0])})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},9479:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getVideos=void 0;const{responseReducer:r}=o(1637),{Connection:s}=o(6084);t.getVideos=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const t=yield s.db.collection("videos").aggregate([{$lookup:{from:"courses",localField:"courseId",foreignField:"_id",as:"courses"}},{$unwind:"$courses"},{$project:{_id:1,videoThumbnailUrl:1,videoMainTitle:1,videoSubTitle:1,videoLength:1,videoWatchCount:"0",overlaysCount:{$cond:{if:{$isArray:"$overlays"},then:{$size:"$overlays"},else:0}},courseName:"$courses.name",courses:"$courses",courseItems:"$courses.items"}},{$match:{$and:[{videoMainTitle:new RegExp(e.query.searchData,"i")}]}}]).toArray();return r(200,t)})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},1173:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addOverlayAnswer=void 0;const r=o(7548),s=o(6084),a=o(1637);t.addOverlayAnswer=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield s.Connection.db.collection("videos").updateOne({_id:new r.ObjectID(e.params.itemId)},{$push:{"overlays.$[].answers":Object.assign({_id:new r.ObjectID},e.body)}})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return a.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},9487:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.addToVideo=void 0;const r=o(6084),s=o(1637),a=o(7548);t.addToVideo=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("videos").updateOne({_id:new a.ObjectID(e.params.itemId)},{$push:e.body})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},5606:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.editVideo=void 0;const r=o(6084),s=o(1637),a=o(7548),i=o(8417);t.editVideo=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("videos").updateOne({_id:new a.ObjectID(e.params.itemId)},{$set:i.flattenObject(e.body)})}catch(e){throw new Error("Shit heppönsz"+e.toString())}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},4824:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.removeFromVideo=void 0;const r=o(6084),s=o(1637),a=o(7548);t.removeFromVideo=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){try{yield r.Connection.db.collection("videos").updateOne({_id:new a.ObjectID(e.params.itemId)},{$pull:e.body})}catch(t){throw new Error("Shit heppönsz"+JSON.stringify(e.body))}return s.responseReducer(201,"Az adatok frissítése sikeres!")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},5913:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadVideoImage=void 0;const r=o(6084),s=o(3647),a=o(1637),i=o(7548);t.uploadVideoImage=(e,t,o)=>{let d;n(void 0,void 0,void 0,(function*(){const t=yield r.Connection.db.collection("videos").findOne({_id:new i.ObjectID(e.params.itemId)});return e.files&&(d=e.files.file),t?s.createFile(d,"/var/lib/assets/epistogram@development/videos/",e.params.itemId):s.createFile(d,"/var/lib/assets/epistogram@development/exams/",e.params.itemId),t&&(yield r.Connection.db.collection("videos").updateOne({_id:new i.ObjectID(e.params.itemId)},{$set:{videoThumbnailUrl:"https://dev.epistogram.com/assets/epistogram/videos/"+e.params.itemId+"."+s.getFileExtension(d.name)}})),a.responseReducer(201,"Adatok hozzáadva az adatbázishoz ")})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(400).send(e.responseText)}))}},8949:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(9479),s=o(3236),a=o(9487),i=o(5606),d=o(4824),c=o(5913),u=o(1173);t.router.get("/video/:videoId",s.getVideo),t.router.get("/",r.getVideos),t.router.put("/video/:itemId",a.addToVideo),t.router.put("/video/:itemId/overlay/answer",u.addOverlayAnswer),t.router.patch("/video/:itemId",i.editVideo),t.router.patch("/video/:itemId/remove",d.removeFromVideo),t.router.put("/video/:itemId/image",c.uploadVideoImage)},2103:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateVote=t.uploadVote=t.getVotes=t.getVote=void 0;const r=o(6084),s=o(1637),a=o(7548),i=o(378);t.getVote=(e,t,o)=>{i.checkRequest(e,t,o,["_id"]),n(void 0,void 0,void 0,(function*(){const t=yield r.Connection.db.collection("votes").findOne({active:!0}),o=yield r.Connection.db.collection("users").findOne({$and:[{_id:new a.ObjectId(e.query._id)},{"voteStats.voteId":t._id}]});t?null===o?s.responseReducer(200,{responseText:"Még nem szavaztál",_id:t._id,voteQuestion:t.voteQuestion,voteFirstAnswerName:t.voteFirstAnswerName,voteFirstAnswerPath:t.voteFirstAnswerPath,voteSecondAnswerName:t.voteSecondAnswerName,voteSecondAnswerPath:t.voteSecondAnswerPath}):s.responseReducer(200,{responseText:"Már szavaztál",voteAnswersCount:t.voteAnswersCount,voteFirstAnswerName:t.voteFirstAnswerName,voteFirstAnswerCount:t.voteFirstAnswerCount,voteSecondAnswerName:t.voteSecondAnswerName,voteSecondAnswerCount:t.voteSecondAnswerCount}):s.responseReducer(400,"Jelenleg nem érhető el egyetlen szavazás sem")})).then((e=>{})).catch((e=>{}))},t.getVotes=(e,t)=>{n(void 0,void 0,void 0,(function*(){const e=yield r.Connection.db.collection("votes").find({}).toArray();return s.responseReducer(200,e)})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch((e=>{t.status(e.responseStatus).send(e.responseText)}))},t.uploadVote=(e,t,o)=>{},t.updateVote=(e,t,o)=>{}},9997:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getVotes=void 0;const{responseReducer:r}=o(1637),{Connection:s}=o(6084);t.getVotes=(e,t,o)=>{n(void 0,void 0,void 0,(function*(){const e=yield s.db.collection("votes").aggregate([]).toArray();return r(200,e)})).then((e=>{t.status(e.responseStatus).send(e.responseText)})).catch(o)}},1535:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=o(2127);t.router=n.Router();const r=o(9997),s=o(2103);t.router.get("/getvote",s.getVote),t.router.get("/getvotes",r.getVotes),t.router.post("/uploadvote",s.uploadVote),t.router.get("/updatevote",s.updateVote)},8038:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=void 0,t.config={uploadFolderPath:"/Users/spenc",backendUrl:"https://dev.epistogram.com/api",backendUrlMinimal:"https://dev.epistogram.com",frontendUrl:"https://dev.epistogram.com",database:{serverUrl:"80.77.112.163:27017",dbName:"epistogramdb",dbUsername:"epistogrambackend",dbPassword:"Arorer243"},tokenSecret:"AROWILLSAVETHEAPP",tokenMailSecret:"AROWILLSAVETHEMAIL",mailHost:"mail.privateemail.com",senderEmail:"private@spenglermanfred.com",senderPassword:"Arorer243*",scpConfig:{host:"80.77.112.163",port:22,username:"spenglermanfred",passphrase:"MrPeach243Cock*"}}},9849:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.emailContent=t.emailConfig=void 0;const n=o(3036),r=o(8038);t.emailConfig={message:{from:r.config.senderEmail},send:!0,transport:n.transporter,views:{options:{extension:"hbs",map:{hbs:"handlebars"}}},preview:!1},t.emailContent=(e,t,o,n)=>({template:"setpassword",message:{to:e,subject:"Értesítés a regisztrációról"},locals:{nev:t,email:e,url:`${o}?token=${n}`}})},3036:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transporter=void 0;const n=o(8123),r=o(8038);t.transporter=n.createTransport({host:r.config.mailHost,port:465,secure:!0,auth:{user:r.config.senderEmail,pass:r.config.senderPassword},tls:{rejectUnauthorized:!1}})},5505:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(6084),s=n(o(8118)),a=n(o(2127)),i=n(o(2473)),d=n(o(479)),c=o(674),u=o(5733),l=o(3913),p=o(6825),$=o(8949),f=o(1535),m=o(1284),v=o(3268),h=o(880),y=o(5218),g=o(5123);r.Connection.connectToMongo();const b=a.default();b.use(i.default.json()),b.use(s.default()),b.use(d.default()),b.use(((e,t,o)=>{t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, Authorization"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PATCH, DELETE"),o()})),b.use("/articles",c.router),b.use("/courses",u.router),b.use("/groups",g.router),b.use("/organizations",l.router),b.use("/tags",y.router),b.use("/tasks",h.router),b.use("/upload",m.router),b.use("/overlays",v.router),b.use("/users",p.router),b.use("/videos",$.router),b.use("/votes",f.router),b.use((()=>{throw new Error("Nem létezik ilyen útvonal")})),b.use(((e,t,o)=>o.status(500).send(e.toString())));const w=process.env.PORT||5e3;b.listen(w,(function(){console.log(`A szerver a(z) ${w}-s porton fut`)}))},378:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequest=void 0,t.checkRequest=(e,t,o,n)=>{let r;e.route.methods.put||e.route.methods.patch||e.route.methods.post?r="body":e.route.methods.post||(r="query"),n.map((t=>{if(null===e[r][t])throw new Error("Nincs megadva "+t)}))}},737:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.checkUser=void 0;const{Connection:r}=o(6084);t.checkUser=(e,t,o)=>n(void 0,void 0,void 0,(function*(){try{if(yield r.db.collection("users").findOne({"userData.email":e.body.email}))throw new Error("User already exist, please login instead.")}catch(e){throw new Error("Signing up failed, please try again later."+e)}}))},6084:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;const n=o(7548),r=o(8038);class s{static connectToMongo(){n.MongoClient.connect(s.url,s.options,((e,t)=>{console.log("Mongodb csatlakoztatva"),s.db=t.db(r.config.database.dbName)}))}}t.Connection=s,s.url="mongodb://localhost:27017/",s.options={bufferMaxEntries:0,useNewUrlParser:!0,useUnifiedTopology:!0}},3647:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.searchImages=t.createFile=t.getFileExtension=void 0;const s=r(o(5747)),{NodeSSH:a}=o(1257),i=new a,d=o(8038);t.getFileExtension=e=>(console.log("FileName: "+e),e.substr(e.lastIndexOf(".")+1)),t.createFile=(e,o,n)=>{s.default.existsSync("./temp/"),s.default.mkdir("./temp/",{recursive:!0},(e=>e)),e.mv("./temp/"+e.name.toLowerCase()).then((()=>{console.log("The file moved successfully")})).catch((e=>{console.log(e)})),i.connect(d.config.scpConfig).then((()=>{console.log("./temp/"+e.name),i.putFile("./temp/"+e.name.toLowerCase(),o+"/"+n+"."+t.getFileExtension(e.name.toLowerCase())).then((()=>{s.default.rm("./temp/"+e.name.toLowerCase(),(()=>{console.log("Ideiglenes fájl törölve")})),console.log("File feltöltve")})).catch((e=>{console.log(e.toString())}))})).catch((e=>console.log(e)))},t.searchImages=e=>n(void 0,void 0,void 0,(function*(){return s.default.readdirSync(e)}))},8417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flattenObject=void 0,t.flattenObject=function(e){let o,n={};for(let r in e)if(e.hasOwnProperty(r))if("object"==typeof e[r]){o=t.flattenObject(e[r]);for(let e in o)o.hasOwnProperty(e)&&(n[r+(isNaN(e)?"."+e:"")]=o[e])}else n[r]=e[r];return n}},8768:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function i(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.generateToken=void 0;const s=o(8038),a=r(o(9722));t.generateToken=(e,t,o,r,i)=>n(void 0,void 0,void 0,(function*(){return console.log(r,i),a.default.sign({userId:r,email:i},s.config.tokenMailSecret,{expiresIn:"24h"})}))},1637:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.responseReducer=void 0,t.responseReducer=(e,t)=>({responseStatus:e,responseText:t})},2773:e=>{e.exports=require("bcryptjs")},2473:e=>{e.exports=require("body-parser")},479:e=>{e.exports=require("cors")},6926:e=>{e.exports=require("email-templates")},2127:e=>{e.exports=require("express")},8118:e=>{e.exports=require("express-fileupload")},5747:e=>{e.exports=require("fs")},9722:e=>{e.exports=require("jsonwebtoken")},7548:e=>{e.exports=require("mongodb")},1257:e=>{e.exports=require("node-ssh")},8123:e=>{e.exports=require("nodemailer")}},t={};!function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,o),s.exports}(5505)})();
//# sourceMappingURL=main.js.map